<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Language Translator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for better aesthetics */
        #chat-container::-webkit-scrollbar {
            width: 8px;
        }
        #chat-container::-webkit-scrollbar-track {
            background: #2d3748; /* gray-800 */
        }
        #chat-container::-webkit-scrollbar-thumb {
            background: #4a5568; /* gray-600 */
            border-radius: 10px;
        }
        #chat-container::-webkit-scrollbar-thumb:hover {
            background: #718096; /* gray-500 */
        }
        /* Typing indicator animation */
        .typing-dot {
            animation: typing-blink 1.4s infinite both;
        }
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes typing-blink {
            0% { opacity: 0.2; }
            20% { opacity: 1; }
            100% { opacity: 0.2; }
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center h-screen p-4">

    <div class="bg-gray-800 rounded-2xl shadow-2xl w-full max-w-2xl h-full flex flex-col">
        <!-- Header -->
        <header class="bg-blue-600 p-4 rounded-t-2xl text-center shadow-lg">
            <h1 class="text-xl font-bold">AI Language Translator</h1>
            <p class="text-sm text-blue-100">แปลภาษาไทย ⇔ ภาษาอังกฤษ</p>
        </header>

        <!-- Chat Container -->
        <main id="chat-container" class="flex-1 p-6 overflow-y-auto space-y-6">
            <!-- Initial AI Welcome Message -->
            <div class="flex items-start gap-3 justify-start">
                <div class="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center flex-shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
                    </svg>
                </div>
                <div class="bg-gray-700 rounded-lg p-4 max-w-md">
                    <p class="text-sm">สวัสดีครับ! พิมพ์ข้อความภาษาไทยเพื่อแปลเป็นภาษาอังกฤษ หรือพิมพ์ภาษาอังกฤษเพื่อแปลเป็นภาษาไทยได้เลย</p>
                </div>
            </div>
        </main>

        <!-- Input Form -->
        <footer class="p-4 border-t border-gray-700">
            <form id="chat-form" class="flex items-center gap-3">
                <textarea id="message-input" class="flex-1 bg-gray-700 rounded-lg p-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none" placeholder="พิมพ์ข้อความของคุณที่นี่..." rows="1"></textarea>
                <button type="submit" id="send-button" class="bg-blue-600 text-white p-3 rounded-full hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                </button>
            </form>
        </footer>
    </div>

    <script>
        const chatContainer = document.getElementById('chat-container');
        const chatForm = document.getElementById('chat-form');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');

        // --- Gemini API Configuration ---
        const apiKey = "AIzaSyA1EC4YnDVMJD6ETz5ek1__kaIbU2X3DIs"; // This will be handled by the environment, no key needed here.
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        const systemPrompt = `Your sole function is to act as a language translator. Analyze the user's input message. If the message is in Thai, translate it to English. If the message is in English, translate it to Thai. Provide only the translated text as your response, without any additional explanations, pleasantries, or context.`;

        // Adjust textarea height automatically
        messageInput.addEventListener('input', () => {
            messageInput.style.height = 'auto';
            messageInput.style.height = (messageInput.scrollHeight) + 'px';
            if (messageInput.scrollHeight > 200) {
                 messageInput.style.overflowY = 'auto';
            } else {
                 messageInput.style.overflowY = 'hidden';
            }
        });

        chatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const userMessage = messageInput.value.trim();
            if (userMessage) {
                displayUserMessage(userMessage);
                getAiResponse(userMessage);
                messageInput.value = '';
                messageInput.style.height = 'auto';
            }
        });
        
        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                chatForm.dispatchEvent(new Event('submit'));
            }
        });


        function scrollToBottom() {
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function displayUserMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.className = 'flex items-start gap-3 justify-end';
            messageElement.innerHTML = `
                <div class="bg-blue-600 rounded-lg p-4 max-w-md">
                    <p class="text-sm text-white">${message}</p>
                </div>
                <div class="w-10 h-10 rounded-full bg-gray-600 flex items-center justify-center flex-shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                </div>
            `;
            chatContainer.appendChild(messageElement);
            scrollToBottom();
        }

        function displayAiMessage(message) {
            const id = `ai-message-${Date.now()}`;
            const messageElement = document.createElement('div');
            messageElement.className = 'flex items-start gap-3 justify-start';
            // Sanitize message to be used in a string literal
            const sanitizedMessage = message.replace(/`/g, '\\`').replace(/\$/g, '\\$');

            messageElement.innerHTML = `
                <div class="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center flex-shrink-0">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
                    </svg>
                </div>
                <div class="group relative bg-gray-700 rounded-lg p-4 max-w-md">
                    <p id="${id}" class="text-sm whitespace-pre-wrap">${message}</p>
                    <button onclick="copyToClipboard('${id}')" class="absolute top-2 right-2 p-1 bg-gray-600 rounded-md text-gray-300 opacity-0 group-hover:opacity-100 transition-opacity">
                        <svg id="copy-icon-${id}" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                        <svg id="check-icon-${id}" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                    </button>
                </div>
            `;
            chatContainer.appendChild(messageElement);
            scrollToBottom();
        }

        function showLoadingIndicator() {
            const loadingElement = document.createElement('div');
            loadingElement.id = 'loading-indicator';
            loadingElement.className = 'flex items-start gap-3 justify-start';
            loadingElement.innerHTML = `
                <div class="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center flex-shrink-0">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
                    </svg>
                </div>
                <div class="bg-gray-700 rounded-lg p-4 max-w-md flex items-center space-x-2">
                    <div class="typing-dot h-2 w-2 bg-gray-400 rounded-full"></div>
                    <div class="typing-dot h-2 w-2 bg-gray-400 rounded-full"></div>
                    <div class="typing-dot h-2 w-2 bg-gray-400 rounded-full"></div>
                </div>
            `;
            chatContainer.appendChild(loadingElement);
            scrollToBottom();
        }

        function removeLoadingIndicator() {
            const loadingIndicator = document.getElementById('loading-indicator');
            if (loadingIndicator) {
                loadingIndicator.remove();
            }
        }
        
        async function getAiResponse(userMessage) {
            sendButton.disabled = true;
            showLoadingIndicator();
            
            const payload = {
                contents: [{ parts: [{ text: userMessage }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.statusText}`);
                }

                const result = await response.json();
                const aiText = result.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (aiText) {
                    displayAiMessage(aiText);
                } else {
                    displayAiMessage("Sorry, it seems there was an error getting a response from the AI.");
                }

            } catch (error) {
                console.error("Failed to get AI response:", error);
                displayAiMessage("Sorry, there was a connection error. Please try again.");
            } finally {
                removeLoadingIndicator();
                sendButton.disabled = false;
                messageInput.focus();
            }
        }
        
        function copyToClipboard(elementId) {
            const textToCopy = document.getElementById(elementId).innerText;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = textToCopy;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);

            // Visual feedback
            const copyIcon = document.getElementById(`copy-icon-${elementId}`);
            const checkIcon = document.getElementById(`check-icon-${elementId}`);
            copyIcon.classList.add('hidden');
            checkIcon.classList.remove('hidden');
            setTimeout(() => {
                copyIcon.classList.remove('hidden');
                checkIcon.classList.add('hidden');
            }, 2000);
        }

    </script>
</body>
</html>

